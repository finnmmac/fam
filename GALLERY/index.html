<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Minimal Gallery</title>
<style>
html, body {
    margin: 0;
    height: 100%;
    background: #111;
    font-family: -apple-system, system-ui, sans-serif;
    overflow: hidden;
}

#gallery {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

#gallery img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    cursor: pointer;
}

#bottomBar {
    position: absolute;
    bottom: 0;
    width: 100%;
    background: rgba(0,0,0,0.85);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 6px 12px;
    box-sizing: border-box;
    font-size: 14px;
    color: #eee;
}

#metadata {
    display: flex;
    gap: 12px;
}

#metadata span {
    cursor: pointer;
    transition: color 0.2s;
}

#metadata span:hover {
    color: #0af;
}

#shuffleBtn {
    background: none;
    border: none;
    padding: 0;
    cursor: pointer;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
}

#shuffleBtn svg {
    fill: #eee;
    width: 16px;
    height: 16px;
    transition: fill 0.2s;
}

#shuffleBtn:hover svg {
    fill: #0af;
}
</style>
</head>
<body>

<div id="gallery">
    <img id="mainImage">
    <div id="bottomBar">
        <div id="metadata">
            <span id="who">-</span>
            <span id="what">-</span>
            <span id="where">-</span>
        </div>
        <button id="shuffleBtn" title="Shuffle">
            <svg viewBox="0 0 24 24">
                <path d="M12 2a10 10 0 1 0 10 10h-2a8 8 0 1 1-8-8v3l4-4-4-4v3z"/>
            </svg>
        </button>
    </div>
</div>

<script>
let images = [];
let index = 0;
let originalOrder = [];
let filteredImages = [];
let filterActive = false;

async function loadGallery() {
    images = await fetch("data.json").then(r => r.json());
    if (!images.length) return;
    originalOrder = [...images];
    filteredImages = [...images];
    showImage(index);
}

function showImage(i) {
    index = i;
    const img = document.getElementById("mainImage");
    const whoEl = document.getElementById("who");
    const whatEl = document.getElementById("what");
    const whereEl = document.getElementById("where");

    const image = filteredImages[i];
    img.src = image.src;

    // Show tag values
    whoEl.textContent = image.who || '-';
    whatEl.textContent = image.what || '-';
    whereEl.textContent = image.where || '-';
}

function nextImage() {
    showImage((index + 1) % filteredImages.length);
}

function prevImage() {
    showImage((index - 1 + filteredImages.length) % filteredImages.length);
}

function applyFilter(tag) {
    filteredImages = originalOrder.filter(img =>
        img.who === tag || img.what === tag || img.where === tag
    );
    filterActive = true;
    showImage(0);
}

function resetShuffle() {
    filteredImages = [...originalOrder];
    filterActive = false;
    // Optionally shuffle
    filteredImages.sort(() => Math.random() - 0.5);
    showImage(0);
}

// Click metadata to filter
document.getElementById("who").addEventListener("click", e => {
    const val = e.target.textContent;
    if(val !== '-') applyFilter(val);
});
document.getElementById("what").addEventListener("click", e => {
    const val = e.target.textContent;
    if(val !== '-') applyFilter(val);
});
document.getElementById("where").addEventListener("click", e => {
    const val = e.target.textContent;
    if(val !== '-') applyFilter(val);
});

// Shuffle button resets filter and shuffles
document.getElementById("shuffleBtn").addEventListener("click", resetShuffle);

document.getElementById("mainImage").addEventListener("click", nextImage);
document.addEventListener("keydown", e => {
    if (e.key === "ArrowRight") nextImage();
    if (e.key === "ArrowLeft") prevImage();
});

window.onload = loadGallery;
</script>

</body>
</html>
